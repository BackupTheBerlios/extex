<project name="ExTeX" default="help" basedir=".">

    <description>ExTeX - build file</description>

    <target name="help" description="Displays usage information">
        <echo>Usage:</echo>
    </target>

    <!-- configure the directories -->
    <property name="jarfile" value="extex"/>
    <property name="src" location="src"/>
    <property name="src.test" location="test"/>
    <property name="classes" location="tmp/classes"/>
    <property name="javadoc" location="doc/javadoc"/>
    <property name="javadocxml" location="doc/javadocxml"/>
    <property name="tmp" location="tmp"/>
    <property name="deploy" location="tmp/ExTeX"/>
    <!-- classpath for the application -->
    <path id="main.class.path">
        <fileset dir="lib">
            <include name="*.jar"/>
            <exclude name="junit.jar"/>
            <exclude name="ant.jar"/>
        </fileset>
    </path>
    <path id="test.class.path">
        <fileset dir="lib">
            <include name="*.jar"/>
            <exclude name="ant.jar"/>
        </fileset>
        <fileset dir="lib.develop">
            <include name="*.jar"/>
            <exclude name="ant.jar"/>
        </fileset>
    </path>

    <target name="compile"
       	  description="Compile the Java files (without tests)">
        <!-- create empty output directory for classes if not present -->
        <mkdir dir="${classes}"/>
        <!-- compile the application code -->
        <javac srcdir="${src}" 
           destdir="${classes}"
           debug="on">
            <classpath refid="main.class.path"/>
        </javac>
        <copy todir="${classes}">
            <fileset dir="src">
                <include name="**/*.properties"/>
                <include name="**/*.xml"/>
                <include name="**/ExTeX-PL"/>
            </fileset>
        </copy>
    </target>

    <target name="compile.test"
       	  description="Compile the Java files (with tests)">
        <!-- create empty output directory for classes if not present -->
        <mkdir dir="${classes}"/>
        <!-- compile the application code -->
        <javac srcdir="${src}" 
           destdir="${classes}"
           debug="on">
            <classpath refid="main.class.path"/>
        </javac>
        <javac srcdir="${src.test}" 
           destdir="${classes}"
           debug="on">
            <classpath refid="main.class.path"/>
            <classpath refid="main.class.path"/>
        </javac>
        <copy todir="${classes}">
            <fileset dir="src">
                <include name="**/*.properties"/>
                <include name="**/*.xml"/>
                <include name="**/ExTeX-PL"/>
            </fileset>
        </copy>
    </target>

    <!-- make a jar from the compiled classes -->
    <!-- the test classes are not included    -->
    <target name="jar"
          depends="compile"
          description="Create jar file with the compiled classes">
        <mkdir dir="${deploy}"/>
        <jar jarfile="${deploy}/${jarfile}.jar">
            <fileset dir="${classes}"/>
            <manifest>
                <attribute name="Built-By" value="${user.name}"/>
                <attribute name="Main-Class" value="de.dante.extex.ExTeX"/>
            </manifest>
        </jar>
    </target>


    <target name="dist"
          depends="deploy"
          description="This is just an alias for old make freaks;-)" />


    <target name="deploy"
          depends="jar"
          description="Create jar file with the compiled classes">
        <delete dir="${deploy}" />
        <mkdir dir="${deploy}/lib" />
        <copy todir="${deploy}/lib">
            <fileset dir="lib">
                <include name="**/*.jar"/>
                <exclude name="**/ant.jar"/>
                <exclude name="**/junit.jar"/>
                <exclude name="**/shiftone-jrat.jar"/>
            </fileset>
        </copy>
        <tstamp/>
        <tar tarfile="${tmp}/ExTeX-${DSTAMP}.tar" basedir="${deploy}">
            <tarfileset dir=".">
            </tarfileset>
        </tar>
        <gzip zipfile="${tmp}/ExTeX-${DSTAMP}.tgz" 
          src="${tmp}/ExTeX-${DSTAMP}.tar" />
        <delete file="${tmp}/ExTeX-${DSTAMP}.tar" />
    </target>


    <target name="clean"
  		  description="Remove unneccesary files and directories">
        <delete dir="${classes}"/>
        <delete dir="${deploy}"/>
        <delete dir="${javadoc}"/>
    </target>


    <target name="javadoc"
  		  description="Create javadoc HTML pages">
        <mkdir dir="${javadoc}" />
        <javadoc 
             destdir="${javadoc}"
             overview="src/overview.html"
             author="true"
             version="true"
             use="true"
             splitindex="true"
             notree="false"
             nonavbar="false"
             noindex="false"
             nodeprecatedlist="false"
             nodeprecated="false">
            <classpath refid="main.class.path"/>
            <packageset dir="${src}" defaultexcludes="yes"/>
        </javadoc>
        <copy todir="${javadoc}">
            <fileset dir="src">
                <include name="**/*.gif"/>
                <include name="**/*.png"/>
            </fileset>
        </copy>
    </target>

    <target name="javadocxml"
  		  description="Create javadoc XML pages">
        <mkdir dir="${javadocxml}" />
        <property name="doc.params" value="-outdir ${javadocxml}"/>
        <javadoc 
	    	doclet="de.dante.util.doclet.XMLDoclet1"
    		additionalparam="${doc.params}">
            <classpath refid="main.class.path"/>
            <classpath refid="test.class.path"/>
            <packageset dir="${src}" defaultexcludes="yes"/>
        </javadoc>
        <copy todir="${javadocxml}">
            <fileset dir="src">
                <include name="**/*.gif"/>
                <include name="**/*.png"/>
            </fileset>
        </copy>
    </target>

    <target name="gcview"
            description="Show the logfile from the GC in the gcviewer"
     >
        <java fork="true" jar="lib.develop/gcviewer.jar">
            <arg value="gc.log"/>
        </java>
    </target>

    <!-- <target name="extex" description="Run ExTeX">
		<java fork="true" classname="de.dante.extex.ExTeX">
			<jvmarg value="-Xms64m"/> 
			<jvmarg value="-Xmx128m"/> 
			<jvmarg value="-Xloggc:gc.log"/> 
		</java>
	</target> -->

</project>
